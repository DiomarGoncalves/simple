<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Visualizador de CSV</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
  :root {
    --bg: #f8fafc;
    --card: #ffffff;
    --text: #0f172a;
    --muted: #475569;
    --border: #e2e8f0;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0; padding: 32px;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;
    background: var(--bg); color: var(--text);
  }
  .container { max-width: 1100px; margin: 0 auto; }
  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,.04);
  }
  h1 { margin: 0 0 12px 0; font-size: 28px; }
  .meta { color: var(--muted); font-size: 14px; margin-bottom: 16px; }
  .toolbar {
    display: flex; gap: 8px; flex-wrap: wrap; align-items: center; margin-bottom: 12px;
  }
  input[type="search"], input[type="file"] {
    padding: 10px 12px; border: 1px solid var(--border); border-radius: 10px;
  }
  button {
    padding: 10px 14px; border: 1px solid var(--border); background: #fff; border-radius: 10px; cursor: pointer;
  }
  button:hover { background: #f1f5f9; }
  table {
    width: 100%; border-collapse: collapse; font-size: 14px; overflow: hidden; border-radius: 12px; border: 1px solid var(--border);
  }
  thead th {
    position: sticky; top: 0; background: #f1f5f9; text-align: left; padding: 10px; border-bottom: 1px solid var(--border);
    cursor: pointer; user-select: none;
  }
  tbody td { padding: 10px; border-bottom: 1px solid var(--border); }
  tbody tr:hover { background: #f9fafb; }
  .footer { margin-top: 12px; color: var(--muted); font-size: 12px; }
</style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Visualizador de CSV</h1>
      <div class="meta">Carregue um arquivo CSV para visualizar e exportar.</div>
      <div class="toolbar">
        <input id="csvFile" type="file" accept=".csv" />
        <input id="search" type="search" placeholder="Pesquisar..." />
        <button onclick="exportCSV()">Baixar CSV filtrado</button>
        <button onclick="window.print()">Imprimir / Salvar PDF</button>
      </div>
      <div class="table-wrap">
        <table id="data">
          <thead><tr id="header"></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="footer">Dica: clique no cabeçalho para ordenar. Use a busca para filtrar.</div>
    </div>
  </div>
<script>
  const fileInput = document.getElementById('csvFile');
  const search = document.getElementById('search');
  const table = document.getElementById('data');
  const theadRow = document.getElementById('header');
  const tbody = table.querySelector('tbody');

  let currentData = [];

  fileInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;

    Papa.parse(file, {
      header: true,
      skipEmptyLines: true,
      complete: function(results) {
        currentData = results.data;
        renderTable(results.meta.fields, results.data);
      }
    });
  });

  function renderTable(columns, rows) {
    theadRow.innerHTML = '';
    tbody.innerHTML = '';

    columns.forEach(col => {
      const th = document.createElement('th');
      th.textContent = col;
      theadRow.appendChild(th);

      th.addEventListener('click', () => sortByColumn(columns.indexOf(col)));
    });

    rows.forEach(r => {
      const tr = document.createElement('tr');
      columns.forEach(c => {
        const td = document.createElement('td');
        td.textContent = r[c] || '';
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
  }

  // Busca simples
  search.addEventListener('input', () => {
    const q = search.value.toLowerCase();
    for (const tr of tbody.rows) {
      let show = false;
      for (const td of tr.cells) {
        if (td.textContent.toLowerCase().includes(q)) { show = true; break; }
      }
      tr.style.display = show ? '' : 'none';
    }
  });

  // Ordenação por coluna
  let sortState = {};
  function sortByColumn(idx) {
    const dir = sortState[idx] === 'asc' ? 'desc' : 'asc';
    sortState = { [idx]: dir };
    const rows = Array.from(tbody.rows).filter(r => r.style.display !== 'none');
    rows.sort((a, b) => {
      const A = a.cells[idx].textContent.trim();
      const B = b.cells[idx].textContent.trim();
      const numA = A.replace(/\./g,'').replace(',','.');
      const numB = B.replace(/\./g,'').replace(',','.');
      const isNum = !isNaN(numA) && !isNaN(numB);
      let cmp = isNum ? (parseFloat(numA) - parseFloat(numB)) : A.localeCompare(B);
      return dir === 'asc' ? cmp : -cmp;
    });
    rows.forEach(r => tbody.appendChild(r));
  }

  // Exporta CSV filtrado
  function exportCSV() {
    if (!currentData.length) { alert("Nenhum CSV carregado!"); return; }
    const rows = [];
    const headers = Array.from(theadRow.children).map(th => th.textContent);
    rows.push(headers.join(','));
    for (const tr of tbody.rows) {
      if (tr.style.display === 'none') continue;
      const cols = Array.from(tr.cells).map(td => '"' + td.textContent.replace(/"/g,'""') + '"');
      rows.push(cols.join(','));
    }
    const blob = new Blob([rows.join('\n')], {type: 'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'csv-filtrado.csv'; a.click();
    URL.revokeObjectURL(url);
  }
</script>
</body>
</html>
